!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(0),n.p,n.p,n.p,n.p,n.p,n.p;var r={formSelector:".popup__container",fieldsetSelector:".popup__form",inputSelector:".popup__form-item",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_inactive",errorClass:"popup__form-item_error"},o=document.querySelector('.popup[data-type="account"]'),i=document.querySelector(".profile__edit-button"),a=document.forms.account,c=a.elements.username,u=a.elements.description,s=document.querySelector('.popup[data-type="place"]'),l=document.querySelector(".profile__add-button"),f=document.forms.place,h=(f.elements.title,f.elements.link,document.querySelector('.popup[data-type="confirm-delete"]')),p=document.forms.avatar,d=document.querySelector('.popup[data-type="avatar"]'),_=document.querySelector(".profile__avatar"),y={name:document.querySelector(".profile__name"),about:document.querySelector(".profile__description"),avatar:document.querySelector(".profile__avatar-image")},v=document.querySelector('.popup[data-type="lightbox"]'),m=document.querySelector(".cards__items");function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var k=function(){function e(t){var n=t.baseUrl,r=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=n,this._headers=r}var t,n,r;return t=e,(n=[{key:"_fetchButCatch",value:function(e,t){return fetch(e,t).then((function(e){return e.ok?e.json():Promise.reject(new Error("Ошибка: ".concat(res.status)))}))}},{key:"getUser",value:function(){return this._fetchButCatch("".concat(this._baseUrl,"/users/me"),{headers:this._headers})}},{key:"setUser",value:function(e){return this._fetchButCatch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})})}},{key:"setAvatar",value:function(e){return this._fetchButCatch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})})}},{key:"uploadCard",value:function(e){return this._fetchButCatch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})})}},{key:"getCards",value:function(){return this._fetchButCatch("".concat(this._baseUrl,"/cards"),{headers:this._headers})}},{key:"deleteCard",value:function(e){return this._fetchButCatch("".concat(this._baseUrl,"/cards/").concat(e._id),{method:"DELETE",headers:this._headers})}},{key:"setLike",value:function(e){return this._fetchButCatch("".concat(this._baseUrl,"/cards/likes/").concat(e._id),{method:"PUT",headers:this._headers})}},{key:"removeLike",value:function(e){return this._fetchButCatch("".concat(this._baseUrl,"/cards/likes/").concat(e._id),{method:"DELETE",headers:this._headers})}}])&&b(t.prototype,n),r&&b(t,r),e}();function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var E=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._fieldsetSelector=t.fieldsetSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._errorClass=t.errorClass,this._form=n,this._submitBtn=this._form.querySelector(this._submitButtonSelector),this._inputList=Array.from(this._form.querySelectorAll(t.inputSelector))}var t,n,r;return t=e,(n=[{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e,e.validationMessage):this._showInputError(e,e.validationMessage)}},{key:"_showInputError",value:function(e,t){this._form.querySelector("#".concat(e.id,"-error")).textContent=t,e.classList.add(this._errorClass)}},{key:"_hideInputError",value:function(e){this._form.querySelector("#".concat(e.id,"-error")).textContent="",e.classList.remove(this._errorClass)}},{key:"_hasInvalidInput",value:function(e){return e.some((function(e){return!e.validity.valid}))}},{key:"_enableBtn",value:function(){this._submitBtn.classList.remove(this._inactiveButtonClass),this._submitBtn.disabled=!1}},{key:"_disableBtn",value:function(){this._submitBtn.classList.add(this._inactiveButtonClass),this._submitBtn.disabled=!0}},{key:"_toggleButtonState",value:function(e){this._hasInvalidInput(e)?this._disableBtn():this._enableBtn()}},{key:"_setEventListeners",value:function(){var e=this;this._toggleButtonState(this._inputList),this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState(e._inputList)}))}))}},{key:"removeErrors",value:function(){var e=this;this._inputList.forEach((function(t){e._hideInputError(t)}))}},{key:"enableValidation",value:function(){var e=this;this._form.addEventListener("submit",(function(t){t.preventDefault(),e._disableBtn()})),this._setEventListeners()}}])&&g(t.prototype,n),r&&g(t,r),e}();function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._cardTitle=t.data.name,this._cardImage=t.data.link,this.cardLikes=t.data.likes,this._cardOwner=t.data.owner,this._templateSelector=n,this._handleCardClick=t.handleCardClick,this._handleLikeClick=t.handleLikeClick,this._handleDeleteClick=t.handleDeleteIconClick,this._userID=t.myId}var t,n,r;return t=e,(n=[{key:"_cloneTemplate",value:function(){this._cardElement=document.querySelector(this._templateSelector).content.querySelector(".card").cloneNode(!0)}},{key:"_setEventListeners",value:function(){var e=this;this._likeButton.addEventListener("click",this._handleLikeClick),this._deleteButton.addEventListener("click",this._handleDeleteClick),this._cardImageElement.addEventListener("click",(function(){e._handleCardClick({name:e._cardTitle,link:e._cardImage})}))}},{key:"generateCard",value:function(){return this._cloneTemplate(),this._likeButton=this._cardElement.querySelector(".card__like-button"),this._deleteButton=this._cardElement.querySelector(".card__delete-button"),this._cardImageElement=this._cardElement.querySelector(".card__image"),this._cardTitleElement=this._cardElement.querySelector(".card__title"),this._cardLikesElement=this._cardElement.querySelector(".card__likes"),this._cardImageElement.src=this._cardImage,this._cardTitleElement.textContent=this._cardTitle,this._cardImageElement.alt=this._cardTitle,this.renderAmountOfLikes(this.cardLikes.length),this.youLiked()&&this.toggleLikeBtnState(),this._setEventListeners(),this._checkOwner(),this._yourCard||this._deleteButton.remove(),this._cardElement}},{key:"renderAmountOfLikes",value:function(e){this._cardLikesElement.textContent=e}},{key:"youLiked",value:function(){var e=this;return this.cardLikes.some((function(t){return t._id===e._userID}))}},{key:"toggleLikeBtnState",value:function(){this._likeButton.classList.toggle("card__like-button_active")}},{key:"removeCard",value:function(){this._cardElement.remove(),this._cardElement=null}},{key:"_checkOwner",value:function(){this._cardOwner._id===this._userID?this._yourCard=!0:this._yourCard=!1}}])&&C(t.prototype,n),r&&C(t,r),e}();function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderer=t.renderer,this._containerElement=t.containerElement}var t,n,r;return t=e,(n=[{key:"render",value:function(e){var t=this;e.forEach((function(e){t._renderer(e)}))}},{key:"addItem",value:function(e){this._containerElement.prepend(e)}}])&&L(t.prototype,n),r&&L(t,r),e}();function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var j=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=t,this._openedSelector="popup_opened",this._handleEscCloseWrapper=this._handleEscClose.bind(this),this._handleMainCloseWrapper=this._handleMainClose.bind(this)}var t,n,r;return t=e,(n=[{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"_handleMainClose",value:function(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-button"))&&this.close()}},{key:"open",value:function(){this._popup.classList.add(this._openedSelector),document.addEventListener("keyup",this._handleEscCloseWrapper)}},{key:"close",value:function(){this._popup.classList.remove(this._openedSelector),document.removeEventListener("keyup",this._handleEscCloseWrapper)}},{key:"setEventListeners",value:function(){this._popup.addEventListener("click",this._handleMainCloseWrapper)}}])&&O(t.prototype,n),r&&O(t,r),e}();function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t,n){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=R(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R(e);if(t){var o=R(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return T(this,n)}}function T(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var D=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(a,e);var t,n,o,i=x(a);function a(e,t,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(o=i.call(this,e))._popup=e,o._submitCallback=t,o._submitButton=o._popup.querySelector(".popup__container"),o._form=o._popup.querySelector(r.formSelector),o._inputSelector=r.inputSelector,o._closeCallback=n,o}return t=a,(n=[{key:"_getInputValues",value:function(){return Object.values(this._form).reduce((function(e,t){return e[t.name]=t.value,e}),{})}},{key:"setEventListeners",value:function(){var e=this;I(R(a.prototype),"setEventListeners",this).call(this),this._submitButton.addEventListener("submit",(function(t){t.preventDefault(),e._submitCallback(e._getInputValues(),t)}))}},{key:"close",value:function(){this._submitButton.removeEventListener("submit",this._submitCallback),I(R(a.prototype),"close",this).call(this),this._form.reset(),this._closeCallback()}}])&&P(t.prototype,n),o&&P(t,o),a}(j);function U(e){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e,t,n){return(M="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=J(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function V(e,t){return(V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J(e);if(t){var o=J(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return W(this,n)}}function W(e,t){return!t||"object"!==U(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&V(e,t)}(i,e);var t,n,r,o=N(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this,e))._popup=e,t._lightboxCaption=t._popup.querySelector(".lightbox__caption"),t._lightboxImage=t._popup.querySelector(".lightbox__image"),t}return t=i,(n=[{key:"open",value:function(e){this._lightboxCaption.textContent=e.name,this._lightboxImage.src=e.link,this._lightboxImage.alt=e.name,M(J(i.prototype),"open",this).call(this)}}])&&A(t.prototype,n),r&&A(t,r),i}(j);function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var z=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._userNameElement=t.name,this._userDescriptionElement=t.about,this._userAvatarElement=t.avatar}var t,n,r;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._userNameElement.textContent,about:this._userDescriptionElement.textContent}}},{key:"setUserInfo",value:function(e){this._userNameElement.textContent=e.name,this._userDescriptionElement.textContent=e.about,this.setUserAvatar(e.avatar)}},{key:"setUserAvatar",value:function(e){this._userAvatarElement.src=e}}])&&H(t.prototype,n),r&&H(t,r),e}();function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Q(e,t,n){return(Q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=$(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function X(e,t){return(X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=$(e);if(t){var o=$(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Z(this,n)}}function Z(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $(e){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}(i,e);var t,n,r,o=Y(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this,e))._popup=e,n._handleFormSubmit=t,n._form=n._popup.querySelector(".popup__container"),n._submitButton=n._form.querySelector(".popup__save-button"),n._element=null,n._obj=null,n}return t=i,(n=[{key:"setEventListeners",value:function(){var e=this;Q($(i.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){t.preventDefault(),e._handleFormSubmit(e._element,e._obj,t)}))}},{key:"open",value:function(e,t){this._element=e,this._obj=t,Q($(i.prototype),"open",this).call(this)}}])&&K(t.prototype,n),r&&K(t,r),i}(j),te=new k({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-16",headers:{authorization:"25068d5b-79ef-423f-8b22-b9922c31ad6c","Content-Type":"application/json"}}),ne=new w({renderer:function(e){var t=oe(e).generateCard();ne.addItem(t)},containerElement:m});function re(e,t){e.target.querySelector(".popup__save-button").textContent=t}function oe(e){var t=new S({data:e,handleCardClick:function(e){se.open(e)},handleLikeClick:function(){t.youLiked()?te.removeLike(e).then((function(e){t.cardLikes=e.likes,t.renderAmountOfLikes(e.likes.length)})).then(t.toggleLikeBtnState()).catch((function(e){return console.log("Ошибка при удалении лайка: ".concat(e))})):te.setLike(e).then((function(e){t.cardLikes=e.likes,t.renderAmountOfLikes(e.likes.length)})).then(t.toggleLikeBtnState()).catch((function(e){return console.log("Ошибка при добавлении лайка: ".concat(e))}))},handleDeleteIconClick:function(){ie.open(t,e)},myId:"7f651893ffa284663c078177"},"#card");return t}var ie=new ee(h,(function(e,t,n){re(n,"Удаление..."),te.deleteCard(t).then(e.removeCard()).then((function(){ie.close(),re(n,"Да")})).catch((function(e){return console.log("Ошибка при удалении карточки: ".concat(e))}))}));ie.setEventListeners();var ae=new D(d,(function(e,t){re(t,"Сохранение..."),te.setAvatar(e.link).then((function(e){ce.setUserAvatar(e.avatar)})).then((function(){ae.close(),re(t,"Сохранить")})).catch((function(e){return console.log("Ошибка при изменении аватара: ".concat(e))}))}),(function(){pe.removeErrors()}));ae.setEventListeners(),_.addEventListener("click",(function(){ae.open()}));var ce=new z(y),ue=new D(o,(function(e,t){re(t,"Сохранение..."),te.setUser(e).then((function(e){ce.setUserInfo({name:e.name,about:e.about,avatar:e.avatar})})).then((function(){ue.close(),re(t,"Сохранить")})).catch((function(e){return console.log("Ошибка при изменении данных профиля: ".concat(e))}))}),(function(){fe.removeErrors()}));ue.setEventListeners(),i.addEventListener("click",(function(){var e=ce.getUserInfo(),t=e.name,n=e.about;c.value=t,u.value=n,ue.open()}));var se=new F(v);se.setEventListeners();var le=new D(s,(function(e,t){re(t,"Добавление...");var n={name:name,link:link};n.name=e.title,n.link=e.link,te.uploadCard(n).then((function(e){var t=oe(e).generateCard();le.close(),ne.addItem(t)})).then((function(){re(t,"Сохранить")})).catch((function(e){return console.log("Ошибка при добавлении карточки: ".concat(e))}))}),(function(){he.removeErrors()}));le.setEventListeners(),l.addEventListener("click",(function(){le.open()})),Promise.all([te.getUser(),te.getCards()]).then((function(e){return console.log("Подключено к серверу и работает!"),{user:e[0],cards:e[1]}})).then((function(e){return ce.setUserInfo(e.user),e})).then((function(e){return e.cards.reverse()})).then((function(e){ne.render(e)})).catch((function(e){return console.log("Ошибка при попытке загрузить данные пользователя и карточки: ".concat(e))}));var fe=new E(r,a);fe.enableValidation();var he=new E(r,f);he.enableValidation();var pe=new E(r,p);pe.enableValidation()}]);